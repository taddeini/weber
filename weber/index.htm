<!DOCTYPE html>
<html>
    <head>
        <title>RSS Client</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="assets/css/main.css">
        <script type="text/javascript" src="assets/js/libs/modernizr-2.5.3.min.js"> </script>
    </head>
    <body>
        <section id="main"></section>

        <script type="text/javascript" src="assets/js/libs/jquery-1.7.1.min.js"> </script>
        <script type="text/javascript" src="assets/js/libs/jquery.tmpl.min.js"> </script>
        <script type="text/javascript" src="assets/js/libs/underscore.min.js"> </script>
        <script type="text/javascript" src="assets/js/libs/moment.min.js"> </script>
        
        <script type="text/javascript" src="src/utils.js"></script>
        <script type="text/javascript" src="src/post.js"> </script>
        
        <script type="text/javascript">
            // TODO: Load should be pushed back as part of either core or sandbox
            var load = (function() {
                return {
                    feed: function(url, callback) {
                        $.ajax({
                            url: document.location.protocol +
                            "//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=10&callback=?&q=" +
                            encodeURIComponent(url),
                            dataType: "json",
                            success: function(data) {
                                callback(data.responseData.feed);
                            }
                        });
                    }
                };
            }());

            // TODO: Render should be pushed back as part of either core or sandbox
            var render = (function() {
                return {
                    post: function(post) {
                        //TODO: Cache the compiled template here
                        $("#postTemplate").tmpl(post).appendTo("#main");
                    }
                };
            }());

            // TODO: refactoring here--currently just wired up for prototyping
            var feed = load.feed("http://feeds.feedburner.com/LosTechies", function(feed) {
                render.post(feed.entries[0]);
            });

            application.register("post", post);
            application.startAll();

        </script>
        
        <script type="text/x-jquery-tmpl" id="postTemplate">
            <article>
                <header>   
                    <h1>${title}</h1>
                    <p class="byline">Posted on <time datetime="${pubDateMeta}">${pubDateDisplay}</time> by ${author}</p>
                </header>
                {{html content}}
            </article>   
        </script>
    </body>
</html>