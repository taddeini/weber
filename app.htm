<!DOCTYPE html>
<html>
    <head>
        <title>RSS Client</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="assets/css/main.css">
        <script type="text/javascript" src="assets/scripts/modernizr-2.5.3.min.js"> </script>
    </head>
    <body>
        <section id="main"></section>

        <script type="text/javascript" src="assets/scripts/jquery-1.7.1.min.js"> </script>
        <script type="text/javascript" src="assets/scripts/underscore.min.js"> </script>
        <script type="text/javascript" src="assets/scripts/moment.min.js"> </script>
        <script type="text/javascript" src="assets/scripts/backbone-min.js"></script>
        
        <script type="text/javascript" src="source/utils.js"> </script>
        
        <script type="text/template" id="postTemplate">
            <article>
                <header>   
                    <h1><%= title%></h1>
                    <p class="byline">Posted on <time datetime="<%= publishedDateMeta%>"><%= publishedDateDisplay%></time> by <%= author%></p>
                </header>
                <%= content%>
            </article>   
        </script>

        <script type="text/javascript">
            
            var Post = Backbone.Model.extend({
                initialize: function () {
                    var helper = utils(moment, $);

                    var pdDisplay = helper.dates.formatDate({
                        date: this.get("publishedDate"),
                        format: "MMMM D, YYYY h:mma"
                    }) + " CDT";

                    var pdMeta = helper.dates.formatDate({ date: this.get("publishedDate") });

                    this.set({ publishedDateDisplay: pdDisplay, publishedDateMeta: pdMeta });
                }
            });

            var Feed = Backbone.Collection.extend({
                initialize: function (feedUrl, callback) {
                    var that = this;
                    utils(moment, $).ajax.getFeed(feedUrl, function (feed) {
                        that.models = feed;
                        callback(that);
                    });
                },

                model : Post
            });

            var PostView = Backbone.View.extend({
                el: "#main",

                template: _.template($("#postTemplate").html()),

                render: function () {
                    var content = this.template(this.model.attributes);
                    this.$el.html(content);
                    return this;
                }
            });

            $(function () {
                new Feed("http://feeds.encosia.com/Encosia", function (feed) {
                    var post = new Post(feed.models.entries[0]);
                    var postView = new PostView({ model: post });
                    postView.render();
                });
            }); 
        </script>
        
        
    </body>
</html>